wkhomeControllers.controller("loadData",["sparqlQuery","searchData","$translate","$routeParams","$scope","$window","translateService","globalData",function(t,e,r,a,u,o,s,l){function c(){var r=l.PREFIX+" CONSTRUCT { ?keyword rdfs:label ?key }  WHERE {      SELECT  (count(?pubs) as ?total)      WHERE {          graph <"+l.centralGraph+'> {             ?subject foaf:publications ?pubs.              ?pubs dcterms:subject ?keywordSubject.              ?keywordSubject rdfs:label ?key.              BIND(REPLACE(?key, " ", "_", "i") AS ?unickey).              BIND(IRI(?unickey) as ?keyword)          }     }      GROUP BY ?keyword  ?key      HAVING(?total > 4) }';t.querySrv({query:r},function(t){jsonld.compact(t,l.CONTEXT,function(t,r){_.map(r["@graph"],function(t){var e={};e.id=t["@id"],e.tag=t["rdfs:label"],u.themes.push({tag:e.tag})}),u.$apply(function(){e.allkeywords=u.themes}),waitingDialog.hide()})})}function n(){if(null==e.clustersAuthors||0==e.clustersAuthors.length){u.clusters=[];var r=[],a=(new Array,l.PREFIX+" CONSTRUCT {   ?author foaf:name ?name.   ?author uc:hasCluster ?clusterId.   ?author rdfs:label ?label.   ?author dcterms:subject ?keywords } WHERE {    graph <"+l.clustersGraph+">     {       ?clusterId uc:hasPerson ?author.      ?clusterId rdfs:label ?label.      {         select DISTINCT ?author ?name ?keywords         where         {          graph <"+l.centralGraph+">           {              ?author foaf:name ?name.              ?author foaf:publications ?publicationUri.              ?publicationUri dcterms:subject ?keywordSubject.               ?keywordSubject rdfs:label ?keywords.          }        } group by ?author ?name ?keywords       }    }}");t.querySrv({query:a},function(t){jsonld.compact(t,l.CONTEXT,function(t,a){_.map(a["@graph"],function(t){var e={},a=t["uc:hasCluster"],u="";if(null!=t["dcterms:subject"]&&(t["dcterms:subject"].constructor===Array||t["dcterms:subject"]instanceof Array))for(i=0;i<t["dcterms:subject"].length&&i<12;i++)u+=0==i?t["dcterms:subject"][i]:", "+t["dcterms:subject"][i];if(null!=a&&(a.constructor===Array||a instanceof Array))for(i=0;i<a.length;i++)e.IdAuthor=t["@id"],e.IdCluster=t["uc:hasCluster"][i]["@id"],e.ClusterName=t["rdfs:label"][i],e.Author=t["foaf:name"],e.Keyword=u,e.Title=t["foaf:name"],e.URI=t["foaf:name"],r.push({idAuthor:e.IdAuthor,cluster:e.IdCluster,clusterName:e.ClusterName,author:e.Author,keyword:e.Keyword,title:e.Title,uri:e.URI});else e.IdAuthor=t["@id"],e.IdCluster=t["uc:hasCluster"]["@id"],e.ClusterName=t["rdfs:label"],e.Author=t["foaf:name"],e.Keyword=u,e.Title=t["foaf:name"],e.URI=t["foaf:name"],r.push({idAuthor:e.IdAuthor,cluster:e.IdCluster,clusterName:e.ClusterName,author:e.Author,keyword:e.Keyword,title:e.Title,uri:e.URI})});var o=new Array;for(i=0,len=r.length;i<len;i++)null==o[r[i].cluster.toString()]&&(o[r[i].cluster.toString()]=new Array,o[r[i].cluster.toString()][0]=1,o[r[i].cluster.toString()][1]=0),o[r[i].cluster.toString()][0]=o[r[i].cluster.toString()][0]+1;for(i=0,len=r.length;i<len;i++)o[r[i].cluster.toString()][0]>4&&o[r[i].cluster.toString()][1]<95&&(u.clusters.push(r[i]),o[r[i].cluster.toString()][1]+=1);e.clustersAuthors=u.clusters,e.areaSearch=null})})}}c(),u.themes=[];var d=l.PREFIX+" CONSTRUCT {          ?keyword rdfs:label ?k;                uc:total ?totalPub }  FROM <"+l.centralGraph+">   WHERE {      SELECT ?keyword ?k (COUNT(DISTINCT(?subject)) AS ?totalPub)      WHERE {          ?person foaf:publications ?subject.          ?subject dcterms:subject ?keywordSubject.          ?keywordSubject rdfs:label ?k.          BIND(IRI(?k) AS ?keyword) .      }      GROUP BY ?keyword ?k      HAVING(?totalPub > 2 && ?totalPub < 180)      ORDER BY DESC(?totalPub)      LIMIT 145 } ";t.querySrv({query:d},function(t){jsonld.compact(t,l.CONTEXT,function(t,r){u.$apply(function(){e.allkeywordsCloud={schema:{context:l.CONTEXT,fields:["rdfs:label","uc:total"]},data:r},waitingDialog.hide()})})}),e.dataRequested||(n(),e.dataRequested=!0),u.clusters=[]}]);