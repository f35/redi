wkhomeControllers.controller("exploreAuthor",["$routeParams","$scope","$rootScope","globalData","searchData","$window","sparqlQuery",function(a,t,o,e,n,r,i){$("html,body").animate({scrollTop:0},"slow"),t.author="",t.authorId="",o.$on("CallParentMethod",function(a){t.clickonRelatedauthor(a)}),t.data="",clickonRelatedauthor=function(a){var o=e.PREFIX+" CONSTRUCT {   <"+a+"> foaf:name ?name; a foaf:Person   }    WHERE  {     <"+a+"> foaf:name ?name } ";i.querySrv({query:o},function(a){jsonld.compact(a,e.CONTEXT,function(a,o){t.$apply(function(){t.data=o})})})},t.ifrightClick=function(t){n.genericData=t,r.location.hash="/"+a.lang+"/w/cloud?datacloud"},t.clickPublications=function(){r.location.hash="/"+a.lang+"/w/publications/"+t.authorId},t.buildnetworks=function(){var a=_.findWhere(t.data["@graph"],{"@type":"foaf:Person"});if(a["foaf:name"]){var o=e.PREFIX+'CONSTRUCT {  <http://ucuenca.edu.ec/wkhuska/resultTitle> a uc:pagetitle. <http://ucuenca.edu.ec/wkhuska/resultTitle> uc:viewtitle "Authors Related With '+a["foaf:name"]+'"  .         ?subject rdfs:label ?name.         ?subject uc:total ?totalPub   } WHERE {  {    SELECT ?subject ?name (COUNT(DISTINCT ?relpublication) as ?totalPub)    WHERE {        GRAPH <'+e.clustersGraph+"> {          ?cluster foaf:publications ?publication .          ?publication uc:hasPerson <"+a["@id"]+"> .          ?cluster foaf:publications ?relpublication .          ?relpublication uc:hasPerson ?subject .          {            SELECT ?name {              GRAPH <"+e.centralGraph+"> {                 ?subject foaf:name ?name .              }            }          }          FILTER (?subject != <"+a["@id"]+">)        }    }    GROUP BY ?subject ?name  }}";waitingDialog.show("Loading Authors Related with "+a["foaf:name"]),i.querySrv({query:o},function(a){jsonld.compact(a,e.CONTEXT,function(a,o){o&&o.hasOwnProperty("@graph")?(t.ifrightClick(o),waitingDialog.hide()):waitingDialog.hide()})})}},null!=n.authorSearch&&1==n.authorSearch["@graph"].length&&clickonRelatedauthor(n.authorSearch["@graph"][0]["@id"]),searchAuthorInfo=function(a){var o=e.PREFIX+" CONSTRUCT {   <"+a+"> foaf:name ?name;  a foaf:Person;   foaf:publications  ?publications.  ?publications ?predicate ?object.  ?publications uc:contributor ?authorsName  }    WHERE  {     <"+a+"> foaf:name ?name.     <"+a+"> foaf:publications  ?publications.     ?publications ?predicate ?object.      ?authors foaf:publications ?publications.      ?authors foaf:name ?authorsName.          } ";i.querySrv({query:o},function(a){jsonld.compact(a,e.CONTEXT,function(a,o){t.$apply(function(){t.author=o["@graph"],t.authorId=o["@graph"][0]["@id"]})})})},t.numeroPub=function(a){return null!=a&&(a.constructor===Array||a instanceof Array)?a.length:1},t.$watch("searchData.authorSearch",function(a,o,e){if(n.authorSearch){var i=n.authorSearch["@graph"];if(i)if(i.length>1){var c=_.map(i,function(a){var t={};return t.id=a["@id"],t.name=a["foaf:name"],t.keyword="",a["dct:subject"]instanceof Array?_.map(a["dct:subject"],function(a,o){o<5&&(t.keyword=t.keyword+a+", ")}):t.keyword=a["dct:subject"],t});t.candidates=c,t.selectedAuthor=function(a,o){n.authorSearch["@graph"]=_.where(i,{"@id":o}),t.data=n.authorSearch,searchAuthorInfo(t.data["@graph"][0]["@id"]),$("#searchResults").modal("hide")},waitingDialog.hide(),$("#searchResults").modal("show")}else n.authorSearch["@graph"]=i,waitingDialog.hide(),searchAuthorInfo(n.authorSearch["@graph"][0]["@id"]);else alert("Information not found"),r.location.hash="/",waitingDialog.hide()}},!0)}]);