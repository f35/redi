wkhomeControllers.controller("exploreAuthor",["$routeParams","$scope","$rootScope","globalData","searchData","$window","sparqlQuery",function(a,t,e,o,n,r,i){$("html,body").animate({scrollTop:0},"slow"),null==n.authorSearch&&(r.location.hash="/"+a.lang),t.authorId="",e.$on("CallParentMethod",function(a){t.clickonRelatedauthor(a)}),t.data="",t.publication=void 0,clickonRelatedauthor=function(a){var e=o.PREFIX+" CONSTRUCT {   <"+a+"> foaf:name ?name; a foaf:Person; foaf:img ?img. } WHERE { <"+a+"> foaf:name ?name; foaf:img?img. } LIMIT 1 ";i.querySrv({query:e},function(a){jsonld.compact(a,o.CONTEXT,function(a,e){t.$apply(function(){t.data=e})})})},t.ifrightClick=function(t){n.genericData=t,r.location.hash="/"+a.lang+"/w/cloud?datacloud"},t.clickPublications=function(){r.location.hash="/"+a.lang+"/w/publications/"+t.authorId},t.buildnetworks=function(){var a=_.findWhere(t.data["@graph"],{"@type":"foaf:Person"});if(a["foaf:name"]){var e=o.PREFIX+'CONSTRUCT {  <http://ucuenca.edu.ec/wkhuska/resultTitle> a uc:pagetitle. <http://ucuenca.edu.ec/wkhuska/resultTitle> uc:viewtitle "Authors Related With '+a["foaf:name"]+'"  .         ?subject rdfs:label ?name.         ?subject uc:total ?totalPub   } WHERE {  {    SELECT ?subject ?name (COUNT(DISTINCT ?relpublication) as ?totalPub)    WHERE {        GRAPH <'+o.clustersGraph+"> {          ?cluster foaf:publications ?publication .          ?publication uc:hasPerson <"+a["@id"]+"> .          ?cluster foaf:publications ?relpublication .          ?relpublication uc:hasPerson ?subject .          {            SELECT ?name {              GRAPH <"+o.centralGraph+"> {                 ?subject foaf:name ?name .              }            }          }          FILTER (?subject != <"+a["@id"]+">)        }    }    GROUP BY ?subject ?name  }}";waitingDialog.show("Loading Authors Related with "+a["foaf:name"]),i.querySrv({query:e},function(a){jsonld.compact(a,o.CONTEXT,function(a,e){e&&e.hasOwnProperty("@graph")?(t.ifrightClick(e),waitingDialog.hide()):waitingDialog.hide()})})}},t.numeroPub=function(a){return null!=a&&(a.constructor===Array||a instanceof Array)?a.length:1},t.$watch("searchData.authorSearch",function(a,e,o){if(n.authorSearch&&n.authorSearch["@graph"]){var i=n.authorSearch["@graph"];if(i.length>1){var c=_.map(i,function(a){var t={};return t.id=a["@id"],t.name=a["foaf:name"]instanceof Array?_.first(a["foaf:name"]):a["foaf:name"],t.keyword="",a["dct:subject"]instanceof Array?_.map(a["dct:subject"],function(a,e,o){o.length-1===e?t.keyword=t.keyword+a.toUpperCase():e<5&&(t.keyword=t.keyword+a.toUpperCase()+", ")}):t.keyword=a["dct:subject"],t});t.candidates=c,t.selectedAuthor=function(a,e){n.authorSearch["@graph"]=_.where(i,{"@id":e}),t.data=n.authorSearch,t.authorId=t.data["@graph"][0]["@id"],$("#searchResults").modal("hide")},waitingDialog.hide(),$("#searchResults").modal("show")}else n.authorSearch["@graph"]=i,t.data=n.authorSearch,waitingDialog.hide(),t.authorId=t.data["@graph"][0]["@id"]}else alert("Information not found"),r.location.hash="/",waitingDialog.hide()},!0)}]);