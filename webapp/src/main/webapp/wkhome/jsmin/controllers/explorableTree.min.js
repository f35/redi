wkhomeControllers.controller("exploreAuthor",["$routeParams","$scope","$rootScope","globalData","searchData","$window","sparqlQuery",function(a,o,t,e,n,i,r){$("html,body").animate({scrollTop:0},"slow"),o.author="",o.authorId="",t.$on("CallParentMethod",function(a){o.clickonRelatedauthor(a)}),o.data="",o.publication=void 0,clickonRelatedauthor=function(a){var t=e.PREFIX+" CONSTRUCT {   <"+a+"> foaf:name ?name; a foaf:Person; foaf:img ?img. } WHERE { <"+a+"> foaf:name ?name; foaf:img?img. } LIMIT 1 ";r.querySrv({query:t},function(a){jsonld.compact(a,e.CONTEXT,function(a,t){o.$apply(function(){o.data=t})})})},o.ifrightClick=function(o){n.genericData=o,i.location.hash="/"+a.lang+"/w/cloud?datacloud"},o.clickPublications=function(){i.location.hash="/"+a.lang+"/w/publications/"+o.authorId},o.buildnetworks=function(){var a=_.findWhere(o.data["@graph"],{"@type":"foaf:Person"});if(a["foaf:name"]){var t=e.PREFIX+'CONSTRUCT {  <http://ucuenca.edu.ec/wkhuska/resultTitle> a uc:pagetitle. <http://ucuenca.edu.ec/wkhuska/resultTitle> uc:viewtitle "Authors Related With '+a["foaf:name"]+'"  .         ?subject rdfs:label ?name.         ?subject uc:total ?totalPub   } WHERE {  {    SELECT ?subject ?name (COUNT(DISTINCT ?relpublication) as ?totalPub)    WHERE {        GRAPH <'+e.clustersGraph+"> {          ?cluster foaf:publications ?publication .          ?publication uc:hasPerson <"+a["@id"]+"> .          ?cluster foaf:publications ?relpublication .          ?relpublication uc:hasPerson ?subject .          {            SELECT ?name {              GRAPH <"+e.centralGraph+"> {                 ?subject foaf:name ?name .              }            }          }          FILTER (?subject != <"+a["@id"]+">)        }    }    GROUP BY ?subject ?name  }}";waitingDialog.show("Loading Authors Related with "+a["foaf:name"]),r.querySrv({query:t},function(a){jsonld.compact(a,e.CONTEXT,function(a,t){t&&t.hasOwnProperty("@graph")?(o.ifrightClick(t),waitingDialog.hide()):waitingDialog.hide()})})}},searchAuthorInfo=function(a){var t=e.PREFIX+" CONSTRUCT {   <"+a+"> foaf:name ?name;  a foaf:Person;   foaf:publications  ?publications.  ?publications ?predicate ?object.  ?publications uc:contributor ?authorsName  }    WHERE  {     <"+a+"> foaf:name ?name.     <"+a+"> foaf:publications  ?publications.     ?publications ?predicate ?object.      ?authors foaf:publications ?publications.      ?authors foaf:name ?authorsName.          } ";r.querySrv({query:t},function(a){jsonld.compact(a,e.CONTEXT,function(a,t){o.$apply(function(){o.author=t["@graph"],o.authorId=t["@graph"][0]["@id"]})})})},o.numeroPub=function(a){return null!=a&&(a.constructor===Array||a instanceof Array)?a.length:1},o.$watch("searchData.authorSearch",function(a,t,e){if(n.authorSearch){var r=n.authorSearch["@graph"];if(r)if(r.length>1){var c=_.map(r,function(a){var o={};return o.id=a["@id"],o.name=a["foaf:name"]instanceof Array?_.first(a["foaf:name"]):a["foaf:name"],o.keyword="",a["dct:subject"]instanceof Array?_.map(a["dct:subject"],function(a,t,e){e.length-1===t?o.keyword=o.keyword+a.toUpperCase():t<5&&(o.keyword=o.keyword+a.toUpperCase()+", ")}):o.keyword=a["dct:subject"],o});o.candidates=c,o.selectedAuthor=function(a,t){n.authorSearch["@graph"]=_.where(r,{"@id":t}),o.data=n.authorSearch,searchAuthorInfo(o.data["@graph"][0]["@id"]),$("#searchResults").modal("hide")},waitingDialog.hide(),$("#searchResults").modal("show")}else n.authorSearch["@graph"]=r,o.data=n.authorSearch,waitingDialog.hide(),searchAuthorInfo(n.authorSearch["@graph"][0]["@id"]);else alert("Information not found"),i.location.hash="/",waitingDialog.hide()}},!0)}]);