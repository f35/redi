wkhomeControllers.controller("keywordsCloud",["$translate","$routeParams","$scope","globalData","sparqlQuery","searchData","$window",function(t,e,a,o,r,l,i){function n(t){var e=angular.lowercase(t);return function(t){return angular.lowercase(t.tag).indexOf(e)!==-1}}if($("html, body").animate({scrollTop:0},"slow","swing"),t.use(e.lang),l.allkeywordsList)a.relatedthemes=l.allkeywordsList,a.selectedItem="";else{a.themes=[];var u=o.PREFIX+" CONSTRUCT { ?keyword rdfs:label ?key } \tFROM <"+o.centralGraph+'>  WHERE {      SELECT  (count(?key) as ?k) ?key          WHERE {              ?subject foaf:publications ?pub.              ?pub bibo:Quote ?key.              BIND(REPLACE(?key, " ", "_", "i") AS ?unickey).              BIND(IRI(?unickey) as ?keyword)          }      GROUP BY ?keyword  ?key      HAVING(?k > 1) }';r.querySrv({query:u},function(t){jsonld.compact(t,o.CONTEXT,function(t,e){_.map(e["@graph"],function(t){var e={};e.id=t["@id"],e.tag=t["rdfs:label"],a.themes.push({tag:e.tag})}),a.$apply(function(){l.allkeywordsList=a.themes,a.relatedthemes=l.allkeywordsList,a.selectedItem=""})})})}if(a.querySearch=function(t){return t?l.allkeywordsList.filter(n(t)):l.allkeywordsList},a.clickonAuthor=function(t){clickonRelatedauthor(t)},clickonRelatedauthor=function(t){var n=o.PREFIX+" CONSTRUCT {   <"+t+"> foaf:name ?name; a foaf:Person   }    WHERE  {Graph <"+o.centralGraph+">{     <"+t+"> a foaf:Person.     <"+t+"> foaf:name ?name } }";r.querySrv({query:n},function(r){jsonld.compact(r,o.CONTEXT,function(o,r){a.$apply(function(){l.authorSearch=r,i.location.hash="/"+e.lang+"/w/search?"+t})})})},a.todos=[],a.ctrlFn=function(t){var e=_.where(t,{"@type":"bibo:Document"}),o=_.where(t,{"@type":"foaf:Person"});a.todos=[],a.autores=[];var r={};_.map(e,function(t){r.id=t["@id"],r.title=t["dct:title"],r.author=t["dct:contributor"]?t["dct:contributor"]:[],r["abstract"]=t["bibo:abstract"]?t["bibo:abstract"]:"Sorry, still not found abstract for this publication.",r.uri=t["bibo:uri"]&&t["bibo:uri"]["@id"]?t["bibo:uri"]["@id"]:"",a.autores=[];var e=0;_.map(t["dct:contributors"],function(t){e+=1;var r=t["@id"]?_.findWhere(o,{"@id":t["@id"]}):_.findWhere(o,{"@id":t});a.autores.push({id:r["@id"],name:r["foaf:name"]})}),r.title&&a.todos.push({id:r.id,title:r.title,"abstract":r["abstract"],uri:r.uri,author:a.autores})}),$("html,body").animate({scrollTop:$("#scrollToHere").offset().top},"slow"),a.loadData()},a.loadData=function(){a.$apply(function(){a.filteredTodos=[],a.currentPage=1,a.numPerPage=10,a.maxSize=5,a.$watch("currentPage + numPerPage",function(){var t=(a.currentPage-1)*a.numPerPage,e=t+a.numPerPage;a.filteredTodos=a.todos.slice(t,e)})})},l.allkeywordsCloud)a.data=l.allkeywordsCloud;else{waitingDialog.show();var u=o.PREFIX+" CONSTRUCT {  ?keyword rdfs:label ?k;  uc:total ?totalPub }  FROM <"+o.centralGraph+">  WHERE {      SELECT ?keyword ?k (COUNT(DISTINCT(?subject)) AS ?totalPub)      WHERE {          ?person foaf:publications ?subject.          ?subject bibo:Quote ?k .          BIND(IRI(?k) AS ?keyword) .      }      GROUP BY ?keyword ?k      HAVING(?totalPub > 2 && ?totalPub < 180)      ORDER BY DESC(?totalPub)  LIMIT 145}";r.querySrv({query:u},function(t){jsonld.compact(t,o.CONTEXT,function(t,e){a.$apply(function(){a.data={schema:{context:o.CONTEXT,fields:["rdfs:label","uc:total"]},data:e},l.allkeywordsCloud={schema:{context:o.CONTEXT,fields:["rdfs:label","uc:total"]},data:e},waitingDialog.hide()})})})}a.selectedItemChange=function(t){if(void 0!=t){waitingDialog.show();var e=o.PREFIX+" CONSTRUCT {  ?keyword rdfs:label ?key1;  uc:total ?totalPub  }  WHERE  {  SELECT DISTINCT ?key1 ?keyword (COUNT(DISTINCT(?publications)) AS ?totalPub) WHERE {     graph <"+o.centralGraph+'>         {         ?publications bibo:Quote ?key1.         ?publications bibo:Quote ?quote .          FILTER (mm:fulltext-search(?quote, "'+t.tag+'")).         BIND(IRI(?key1) AS ?keyword)      }  }  GROUP BY ?key1 ?keyword    }';r.querySrv({query:e},function(t){jsonld.compact(t,o.CONTEXT,function(t,e){a.$apply(function(){a.data={schema:{context:o.CONTEXT,fields:["rdfs:label","uc:total"]},data:e},waitingDialog.hide()})})})}else a.data=l.allkeywordsCloud},a.exportReport=function(t){a.keyw=t,a.showRepButtons=!0}}]);