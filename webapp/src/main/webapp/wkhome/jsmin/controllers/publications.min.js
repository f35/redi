wkhomeControllers.controller("publicationsController",["$scope","$window","globalData","sparqlQuery","searchData","$routeParams","$translate",function(t,i,a,e,o,n,r){r.use(n.lang),t.publications=[],t.author={};var c=n.authorId,u=a.PREFIX+" CONSTRUCT { <"+c+"> uc:publication ?publicationUri.  ?publicationUri a bibo:Document.  ?publicationUri dct:title ?title.  ?publicationUri bibo:abstract ?abstract.  ?publicationUri bibo:uri ?uri.  ?publicationUri bibo:Quote ?keyword.  }  WHERE { GRAPH <"+a.centralGraph+"> { <"+c+"> foaf:publications ?publicationUri . ?publicationUri dct:title ?title . OPTIONAL { ?publicationUri bibo:abstract  ?abstract.  }  OPTIONAL { ?publicationUri bibo:uri  ?uri.  }  OPTIONAL { ?publicationUri bibo:Quote ?keyword. } }}  ORDER BY DESC(?title)";waitingDialog.show("Searching: "),e.querySrv({query:u},function(i){jsonld.compact(i,a.CONTEXT,function(i,a){if(a){var e=a["@graph"],o=_.where(e,{"@type":"bibo:Document"}),n=o.length?o:[o],r={};_.map(n,function(i){r.id=i["@id"],r.title=i["dct:title"],r["abstract"]=i["bibo:abstract"]?i["bibo:abstract"]:"",r.uri=t.findPDF(i["bibo:uri"]),r.keywords=i["bibo:Quote"],r.title&&t.publications.push({id:r.id,title:r.title,"abstract":r["abstract"],uri:r.uri,keywords:r.keywords})}),t.loadData(),waitingDialog.hide()}else waitingDialog.hide()})});var l=a.PREFIX+"CONSTRUCT {  <"+c+"> a foaf:Person ;                    foaf:name ?name ;                    dct:subject ?area ;                    dct:provenance ?provenance .  ?provenance uc:city ?city .  ?provenance uc:province ?province .  ?provenance uc:fullName ?fullname .} WHERE{  {  \tSELECT *    WHERE {       GRAPH <http://ucuenca.edu.ec/wkhuska> {        <"+c+"> a foaf:Person ;                           foaf:name ?name ;                           dct:provenance ?provenance ;        OPTIONAL { <"+c+"> dct:subject ?area . }        {          SELECT ?city ?province ?fullname {            GRAPH <http://ucuenca.edu.ec/wkhuska/endpoints> {              ?provenance uc:city ?city .              ?provenance uc:province ?province .              ?provenance uc:fullName ?fullname .            }          }        }      }    }    LIMIT 10  }}";e.querySrv({query:l},function(i){jsonld.compact(i,a.CONTEXT,function(i,a){if(!i){var e=a["@graph"];t.author.name=e[0]["foaf:name"],t.author.areas=e[0]["dct:subject"],t.author.city=e[1]["uc:city"],t.author.province=e[1]["uc:province"],t.author.institution=e[1]["uc:fullName"]}})}),t.findPDF=function(t){var i={uri:"",type:""};return"[object Array]"===Object.prototype.toString.call(t)?_.each(t,function(t){return i.uri=t["@id"],t["@id"].indexOf(".pdf")!==-1?(i.type="pdf",i):void(i.type="web")}):"object"==typeof t&&(i.uri=t["@id"],i.type=t["@id"].indexOf(".pdf")!==-1?"pdf":"web"),i},t.loadData=function(){t.$apply(function(){t.filterPublications=[],t.currentPage=1,t.numPerPage=10,t.maxSize=5,t.$watch("currentPage + numPerPage",function(){var i=(t.currentPage-1)*t.numPerPage,a=i+t.numPerPage;t.filterPublications=t.publications.slice(i,a)})})},t.loadAuthorProfile=function(){i.location.hash="/"+n.lang+"/w/search?"+c}}]);