wkhomeControllers.controller("searchText",["$routeParams","$scope","$window","globalData","sparqlQuery","searchData",function(a,e,r,t,o,n){String.format=function(){for(var a=arguments[0],e=1;e<arguments.length;e++){var r=new RegExp("\\{"+(e-1)+"\\}","gm");a=a.replace(r,arguments[e])}return a};var i=t.PREFIX+" CONSTRUCT {  ?s a foaf:Person.  ?s foaf:name ?name.  ?s dct:subject ?key. }  WHERE {  {      SELECT DISTINCT ?s ?name  ?key      WHERE {          GRAPH <"+t.centralGraph+"> {             ?s a foaf:Person.              ?s foaf:name ?name.             ?s foaf:publications ?pub.              ?pub dct:title ?title.              optional { ?s dct:subject ?key }             {0}     } }   }  }";e.submit=function(){if(e.searchText){console.log(e.searchText),waitingDialog.show();var s=' FILTER(mm:fulltext-search(str(?name), "'+e.searchText+'", "es")).',c=String.format(i,s);o.querySrv({query:c},function(s){jsonld.compact(s,t.CONTEXT,function(s,c){if(c["@graph"])waitingDialog.hide(),n.authorSearch=c,r.location.hash="/"+a.lang+"/w/search?"+e.searchText;else{var l='FILTER(CONTAINS(UCASE(?name), "{0}" )) . ',h=e.searchText.trim(),u=h.split(" "),f="";u.forEach(function(a){a.length>0&&(f+=String.format(l,a.toUpperCase()))});var m=String.format(i,f);o.querySrv({query:m},function(i){jsonld.compact(i,t.CONTEXT,function(i,s){if(s["@graph"])waitingDialog.hide(),n.authorSearch=s,r.location.hash="/"+a.lang+"/w/search?"+e.searchText;else{var c=t.PREFIX+" CONSTRUCT { ?keywordduri rdfs:label ?k }  WHERE {  {      SELECT DISTINCT (sample(?keyword) AS ?keywordduri) ?k      WHERE {          GRAPH <"+t.centralGraph+'> {         ?s foaf:publications ?pub.          ?pub bibo:Quote ?k.         BIND(IRI(?k) AS ?keyword) .          FILTER(mm:fulltext-search(str(?k), "'+e.searchText+'")).     } }      GROUP BY ?k   }  }';o.querySrv({query:c},function(e){jsonld.compact(e,t.CONTEXT,function(e,t){t["@graph"]?(waitingDialog.hide(),n.areaSearch=t,r.location.hash="/"+a.lang+"/cloud/group-by"):("es"===a.lang?alert("La informaci√≥n no se encuentra disponible en REDI en este momento."):alert("The information is not available in REDI at the moment. Please try again later."),waitingDialog.hide())})})}})})}})})}}}]);