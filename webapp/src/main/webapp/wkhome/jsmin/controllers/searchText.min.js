wkhomeControllers.controller("searchText",["$routeParams","$scope","$window","globalData","sparqlQuery","searchData",function(a,e,r,o,t,n){String.format=function(){for(var a=arguments[0],e=1;e<arguments.length;e++){var r=new RegExp("\\{"+(e-1)+"\\}","gm");a=a.replace(r,arguments[e])}return a};var i=o.PREFIX+"CONSTRUCT { ?s a foaf:Person; foaf:name ?name; dct:subject ?key; foaf:img ?img. }FROM <"+o.centralGraph+">WHERE {  ?s a foaf:Person;       foaf:name ?name;       foaf:publications [].  OPTIONAL { ?s foaf:topic_interest ?topic }  OPTIONAL { ?topic rdfs:label ?key.}   OPTIONAL { ?s foaf:img   ?img }  {0}}";e.submit=function(){if(e.searchText){console.log(e.searchText),waitingDialog.show();var c=' FILTER(mm:fulltext-search(str(?name), "'+e.searchText+'", "es")).',s=String.format(i,c);t.querySrv({query:s},function(c){jsonld.compact(c,o.CONTEXT,function(c,s){if(s["@graph"])waitingDialog.hide(),n.authorSearch=s,r.location.hash="/"+a.lang+"/w/search?"+e.searchText;else{var l='FILTER(CONTAINS(UCASE(?name), "{0}" )) . ',f=e.searchText.trim(),h=f.split(" "),u="";h.forEach(function(a){a.length>0&&(u+=String.format(l,a.toUpperCase()))});var g=String.format(i,u);t.querySrv({query:g},function(i){jsonld.compact(i,o.CONTEXT,function(i,c){if(c["@graph"])waitingDialog.hide(),n.authorSearch=c,r.location.hash="/"+a.lang+"/w/search?"+e.searchText;else{var s=o.PREFIX+" CONSTRUCT { ?keywordduri rdfs:label ?k }  WHERE {  {      SELECT DISTINCT (sample(?keyword) AS ?keywordduri) ?k      WHERE {          GRAPH <"+o.centralGraph+'> {         ?s foaf:publications [dct:subject ?keyword].         ?keyword rdfs:label ?k.         FILTER(mm:fulltext-search(str(?k), "'+e.searchText+'")).     } }      GROUP BY ?k   }  }';t.querySrv({query:s},function(e){jsonld.compact(e,o.CONTEXT,function(e,o){o["@graph"]?(waitingDialog.hide(),n.areaSearch=o,r.location.hash="/"+a.lang+"/cloud/group-by"):(alert("Information not found"),waitingDialog.hide())})})}})})}})})}}}]);