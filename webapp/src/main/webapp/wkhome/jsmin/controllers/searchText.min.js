wkhomeControllers.controller("searchText",["$routeParams","$scope","$window","globalData","sparqlQuery","searchData","searchQueryService","SolrSearch",function(e,a,n,r,t,i,o,l){String.format=function(){for(var e=arguments[0],a=1;a<arguments.length;a++){var n=new RegExp("\\{"+(a-1)+"\\}","gm");e=e.replace(n,arguments[a])}return e},a.submit=function(){a.searchText&&(waitingDialog.show(),l.get({search:a.searchText},function(l){if(l.response.docs){var s=l.response.docs;if(s.length>1){var c=_.map(s,function(e){var a={};return a.id=e["lmf.uri"],a.name=_.max(e.name,function(e){return e.length}),a.keyword=_.chain(e.topics).uniq().first(10).value().join(", "),a});a.candidates=c,a.selectedAuthor=function(a,r){$("#searchResults").modal("hide"),$("#searchResults").on("hidden.bs.modal",function(){n.location.hash="/"+e.lang+"/w/author/"+r})},waitingDialog.hide(),$("#searchResults").modal("show")}else if(1===s.length){var h=s[0]["lmf.uri"];waitingDialog.hide(),n.location.hash="/"+e.lang+"/w/author/"+h}else{var u=r.PREFIX+" CONSTRUCT { ?keywordduri rdfs:label ?k }  WHERE {  {      SELECT DISTINCT (sample(?keyword) AS ?keywordduri) ?k      WHERE {          GRAPH <"+r.centralGraph+'> {         ?s foaf:publications [dct:subject ?keyword].         ?keyword rdfs:label ?k.         FILTER(mm:fulltext-search(str(?k), "'+a.searchText+'")).     } }      GROUP BY ?k   }  }';t.querySrv({query:u},function(l){jsonld.compact(l,r.CONTEXT,function(l,s){if(s["@graph"])waitingDialog.hide(),i.areaSearch=s,n.location.hash="/"+e.lang+"/cloud/group-by";else{var c={textSearch:a.searchText};o.querySrv(c,function(a){for(var o="",l=0;l<Object.keys(a).length-2;l++)o+=a[l];o&&""!==o&&"undefinedundefinedundefinedundefined"!==o&&t.querySrv({query:o},function(a){jsonld.compact(a,r.CONTEXT,function(a,r){r["@graph"]?(waitingDialog.hide(),i.publicationsSearch=r,n.location.hash="/"+e.lang+"/w/listAllText"):("es"===e.lang?alert("La informaciÃ³n no se encuentra disponible en REDI en este momento."):alert("The information is not available in REDI at the moment. Please try again later."),waitingDialog.hide())})})})}})})}}}))}}]);