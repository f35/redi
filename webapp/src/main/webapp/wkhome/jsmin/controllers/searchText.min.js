wkhomeControllers.controller("searchText",["$routeParams","$scope","$window","globalData","sparqlQuery","searchData","searchQueryService",function(e,a,r,t,n,o,i){String.format=function(){for(var e=arguments[0],a=1;a<arguments.length;a++){var r=new RegExp("\\{"+(a-1)+"\\}","gm");e=e.replace(r,arguments[a])}return e};var c=t.PREFIX+"CONSTRUCT { ?s a foaf:Person; foaf:name ?name; dct:subject ?key; foaf:img ?img. }FROM <"+t.centralGraph+">WHERE {  ?s a foaf:Person;       foaf:name ?name;       foaf:publications [].  OPTIONAL { ?s foaf:topic_interest ?topic }  OPTIONAL { ?topic rdfs:label ?key.}   OPTIONAL { ?s foaf:img   ?img }  {0}}";a.submit=function(){if(a.searchText){console.log(a.searchText),waitingDialog.show();var l=' FILTER(mm:fulltext-search(str(?name), "'+a.searchText+'", "es")).',s=String.format(c,l);n.querySrv({query:s},function(l){jsonld.compact(l,t.CONTEXT,function(l,s){if(s["@graph"])waitingDialog.hide(),o.authorSearch=s,r.location.hash="/"+e.lang+"/w/search?"+a.searchText;else{var f='FILTER(CONTAINS(UCASE(?name), "{0}" )) . ',h=a.searchText.trim(),u=h.split(" "),g="";u.forEach(function(e){e.length>0&&(g+=String.format(f,e.toUpperCase()))});var m=String.format(c,g);n.querySrv({query:m},function(c){jsonld.compact(c,t.CONTEXT,function(c,l){if(l["@graph"])waitingDialog.hide(),o.authorSearch=l,r.location.hash="/"+e.lang+"/w/search?"+a.searchText;else{var s=t.PREFIX+" CONSTRUCT { ?keywordduri rdfs:label ?k }  WHERE {  {      SELECT DISTINCT (sample(?keyword) AS ?keywordduri) ?k      WHERE {          GRAPH <"+t.centralGraph+'> {         ?s foaf:publications [dct:subject ?keyword].         ?keyword rdfs:label ?k.         FILTER(mm:fulltext-search(str(?k), "'+a.searchText+'")).     } }      GROUP BY ?k   }  }';n.querySrv({query:s},function(c){jsonld.compact(c,t.CONTEXT,function(c,l){if(l["@graph"])waitingDialog.hide(),o.areaSearch=l,r.location.hash="/"+e.lang+"/cloud/group-by";else{var s={textSearch:a.searchText};i.querySrv(s,function(a){for(var i="",c=0;c<Object.keys(a).length-2;c++)i+=a[c];i&&""!==i&&"undefinedundefinedundefinedundefined"!==i&&n.querySrv({query:i},function(a){jsonld.compact(a,t.CONTEXT,function(a,t){t["@graph"]?(waitingDialog.hide(),o.publicationsSearch=t,r.location.hash="/"+e.lang+"/w/listAllText"):("es"===e.lang?alert("La informaciÃ³n no se encuentra disponible en REDI en este momento."):alert("The information is not available in REDI at the moment. Please try again later."),waitingDialog.hide())})})})}})})}})})}})})}}}]);